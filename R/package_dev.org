#+TITLE: Rパッケージ開発入門
#+STARTUP: overview
* 第一歩
** はじめに
なぜ本書で学ぶスキルが重要か

本書のゴール: 自力でバッケージを書けるようになること
なぜパッケージを書くのか
- 人と共有したいコードがある
- 規約に従うことによって自分自身の時間を節約するため
*** 哲学
自動化できるものは自動化する！これはdevtoolsでできる．
**** devtools のデメリット
パッケージがどのように構成されているのかを遮蔽してしまう．
詳しく学ぶには公式の[[http://bit.ly/iEYWyMy][Writing R Extensions]]が一番．
ただし，難しいので基本を理解してから．
*** 学習開始
**** パッケージのインストール
#+BEGIN_SRC R
  install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
  devtools::install_github("hadley/devtools")
#+END_SRC
**** その他必要なもの
Xcode または Command-Line Tools for Xcode
** パッケージの構造
- パッケージの基本的な構造
- どのような形式をとれるのか
*** パッケージに名前をつける
**** 名前の要件
- 文字と数字（とピリオド: 非推奨）だけで構成されること
- 文字で始まること
- ピリオドでは終わらないこと
**** 名前を付ける方法
- Google で検索しやすく
- 大文字と小文字の両方を使わない
- 略語を使用する
- 最後に r を追加する
*** パッケージを作成する
以下を実行
devtools::create("path/to/package/pkgname")

以下が生成
- R/: [[*R%E3%82%B3%E3%83%BC%E3%83%89][第3章 Rコード]]で説明
- DESCRIPTION: [[*%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF][第4章 パッケージのメタデータ]]で説明
- NAMESPACE: [[*%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93][第8章 名前空間]]で説明
*** Rstudio プロジェクト
*** パッケージとは
5種類ある．
**** ソースパッケージ
自身のマシンの中の開発バージョンのこと．
**** バンドルパッケージ
.tar.gzの形で1つのファイルに圧縮されたもの．
必要になったときには，devtools::build() すれば生成する．
バンドルパッケージソースパッケージと似ているが，は以下のような特徴がある
- vignetteがビルドされていて，.md や.tex ではなく，HTML や PDF の出力が作成されている．
- ソースパッケージに開発高速化のための一時ファイルが入っていない．
- .Rbuildignore にリストされたファイルが取り除かれている
***** ignore すべきファイル
- .Rproj
- .Rproj.user
- README.Rmd
- cran-comments.md
- NEWS.md
- .travis.yml
**** バイナリパッケージ
R パッケージ開発ツールを持っていないユーザに配布する場合の形．
ただし，プラットフォームに依存する．
内部構造はソースパッケージとかなり違う．
- R/ には .R ファイルがない．そのかわり，関数が読み込まれ，最適なファイル形式で保存されている．
- Meta/ にたくさんの Rds ファイルがアク．
- html/ にヘルプに必要なファイルがある
- src/ が libs/ に変わり，コンパイル結果が入っている
- inst/ が最上位に移動している
**** インストール済みのパッケージ
**** インメモリパッケージ
ロードされ，検索パスにアタッチされたパッケージ．
*** ライブラリとは
インストール済みのパッケージを含むディレクトリのこと．
**** library() と require() の違い
library() はパッケージが見つからないときエラーを返す．
ただし，パッケージを開発する時にはどちらもパッケージ内で*絶対に使用してはいけない*!!
* パッケージコンポーネント
パッケージの各コンポーネントについての説明．
** Rコード
ディレクトリR/
** パッケージのメタデータ
DESCRIPTIONが説明すること
- 作成したパッケージが何を解決するのか
- 誰がパッケージを使えるのか
- 不具合発見時の連絡先
** オブジェクトのドキュメント
roxygen2を使った文書化: 他の人々（未来の自分も含む）に，パッケージ内の特定の関数の使い方を理解してもらうため
コードとドキュメントを一緒に作れる
作成したパッケージ内の各関数の細かく詳細な情報を記述する
** vignette: 長文形式のドキュメント
詳細な情報ではなく，全体像を描く．
複数のコンポーネントをどのように組み合わせれば問題を解くことができるを説明する．
- Rmarkdown
- knitr
を使う．
** テスト
非公式な対話的テストを公式な方法で自動化する
- 作成したパッケージが期待通りに機能することを保証するため
- 変更を加えてもそれが機能し続けるため
** 名前空間
NAMESPACE ファイルは，自分のパッケージにおいて，
- どの関数が他のパッケージから使うことができるか
- どの関数が他のパッケージに依存しているか
を定義する．
roxygen2 を使って生成する．
** 外部データ
data/を使えば，パッケージ内にデータを含められる．
- ユーザが簡単にデータにアクセスするため
- わかりやすい例を示すため
** コンパイル済みのコード
src/
高速なコンパイル済コードを入れる場所
パッケージのパフォーマンスのボトルネックになっている部分を解決する
** インストール済のファイル
inst/
任意の追加ファイルを入れる．
- 引用
- ライセンス
- 著作権
** その他のコンポーネント
- demo/
- exec/
- po/
- tools
* ベストプラクティス
特定のディレクトリに対してではなく，一般的なベストプラクティスについて
** Git と GitHub
RStudioで使う方法
** 自動チェック
自動品質チェック機能
自動チェックの結果が出す警告の読み方
R CMD check
** パッケージのリリース
2つのリリース方法
- CRAN
- GitHub
